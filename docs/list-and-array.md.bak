# List and Array Processing Functions

This document covers the **6 list and array processing functions** that handle conversions between Excel arrays, JSON arrays, and provide specialized array manipulation capabilities.

## listToJson

**Purpose**: Convert a 1-D Excel array (range) into a JSON array string.

**Syntax**: 
```excel
=listToJson(arr)
```

```excel
=LAMBDA(arr,
    LET(
        quoted, MAP(arr, LAMBDA(x, jsonQuote(x))),
        joined, TEXTJOIN(",",TRUE,quoted),
        "[" & joined & "]"
    )
)
```

**Example**:
```excel
=listToJson({"apple";"banana";"cherry"})
    -> ["apple","banana","cherry"]

=listToJson({1;2;3})
    -> [1,2,3]
```

---

## listFromJson

**Purpose**: Convert a JSON array string into an Excel vertical array of unquoted values.

**Syntax**: 
```excel
=listFromJson(json)
```

```excel
=LAMBDA(json,
    LET(
        inner, MID(TRIM(json),2,LEN(TRIM(json))-2),
        parts, IF(inner="", MAKEARRAY(0,1,LAMBDA(r,c,"")), TEXTSPLIT(inner, ",",,TRUE)),
        TRIM(SUBSTITUTE(parts, """", ""))
    )
)
```

**Example**:
```excel
=listFromJson("[\"apple\",\"banana\",\"cherry\"]")
    -> {"apple";"banana";"cherry"}

=listFromJson("[1,2,3]")
    -> {1;2;3}
```

**Note**: This parser assumes simple values without nested arrays/objects containing commas.

---

## arrayRepAdd

**Purpose**: Internal helper function that adds or replaces a key/value pair in a two-column array while ensuring no duplicate keys remain.

**Syntax**: 
```excel
=arrayRepAdd(arr, key, val)
```

```excel
=LAMBDA(arr,key,val,
    LET(
        safeArr, IF(ROWS(arr)=0, HSTACK("", ""), arr),
        kcol, INDEX(safeArr,,1),
        vcol, INDEX(safeArr,,2),
        newarr, safeFilter(safeArr, kcol<>key),
        cleanArr, IF(ROWS(newarr)=0, HSTACK("", ""), newarr),
        VSTACK(cleanArr, HSTACK(key, jsonQuote(val)))
    )
)
```

**Usage**: Used internally by `jsonSet`, `jsonJoin`, and `jsonRemove` functions. Generally not called directly by users.

---

## CountUnique

**Purpose**: Count occurrences of each unique value in an array and return a two-column summary.

**Syntax**: 
```excel
=CountUnique(arr)
```

```excel
=LAMBDA(arr,
    LET(
        flat, TOCOL(arr,1),
        uniques, UNIQUE(flat),
        counts, MAP(uniques, LAMBDA(u, SUM((flat=u)*1))),
        HSTACK(uniques, counts)
    )
)
```

**Example**:
```excel
=CountUnique({"apple";"banana";"apple";"cherry";"banana";"apple"})
    -> {"apple",3;"banana",2;"cherry",1}
```

**Use Cases**:
- Data analysis and frequency counting
- Survey response analysis
- Inventory summarization

---

## vLastItem

**Purpose**: Get the last non-empty item from a vertical array, with optional default value for empty arrays.

**Syntax**: 
```excel
=vLastItem(array1, [emptyvalue])
```

```excel
=LAMBDA(array1,[emptyvalue],
    XLOOKUP(TRUE,(array1<>IF(ISOMITTED(emptyvalue),"",emptyvalue)),array1,"N/A",0,-1)
)
```

**Example**:
```excel
=vLastItem({"first";"middle";"";"last"})
    -> "last"

=vLastItem({"";"";""},"default")
    -> "default"
```

**Use Cases**:
- Finding the most recent non-empty entry in a list
- Getting final valid values from data series
- Default value handling for empty datasets

---

## SelectFilter

**Purpose**: Advanced filtering that combines column selection with row filtering in a single operation.

**Syntax**: 
```excel
=SelectFilter(ArrayIn, ComSepColNumsInBraces, Filters)
```

```excel
=LAMBDA(ArrayIn,ComSepColNumsInBraces,Filters,
    FILTER(INDEX(ArrayIn,SEQUENCE(ROWS(ArrayIn)),ComSepColNumsInBraces),Filters,NA())
)
```

**Parameters**:
- `ArrayIn`: Source array to filter
- `ComSepColNumsInBraces`: Array of column numbers to select (e.g., {1;3;5})
- `Filters`: Boolean array for row filtering

**Example**:
```excel
// Select columns 1 and 3, filter rows where column 2 > 10
=SelectFilter(A1:C10, {1;3}, B1:B10>10)
```

**Use Cases**:
- Complex data filtering with column projection
- Report generation with specific field selection
- Database-like operations in Excel

## Function Integration

These array processing functions integrate seamlessly with the JSON system:

- **`listToJson`** and **`listFromJson`** provide bidirectional conversion between Excel arrays and JSON arrays
- **`arrayRepAdd`** powers the JSON manipulation functions by managing key-value collections
- **`CountUnique`**, **`vLastItem`**, and **`SelectFilter`** provide advanced data processing capabilities that complement JSON workflows

This combination enables sophisticated data transformation pipelines that can process arrays, convert to JSON for complex manipulation, and convert back to Excel arrays for final presentation.