# Safety and Utility Functions

This document covers the **6 safety and utility functions** that provide error-resistant operations, data validation, and specialized text processing capabilities.

## safeDrop

**Purpose**: Safely drop rows from an array with error protection, returning a safe empty array when the drop operation would fail.

**Syntax**: 
```excel
=safeDrop(arr, rows)
```

```excel
=LAMBDA(arr,rows,
    LET(
        dropped, IFERROR(DROP(arr, rows),MAKEARRAY(1, COLUMNS(arr), LAMBDA(r,c,""))),
        out, dropped,
        out
    )
)
```

**Example**:
```excel
=safeDrop(A1:C5, 3)  // Drop first 3 rows
=safeDrop(A1:C2, 5)  // Safely handles over-drop, returns empty array
```

**Use Cases**:
- Safe array manipulation in dynamic formulas
- Preventing errors in data processing pipelines
- Robust header removal operations

---

## safeFilter

**Purpose**: Error-resistant wrapper around FILTER that returns a properly sized empty array instead of errors when no rows match the filter criteria.

**Syntax**: 
```excel
=safeFilter(arr, include)
```

```excel
=LAMBDA(arr,include,
    LET(
        cols, COLUMNS(arr),
        safe, IFERROR(FILTER(arr, include), MAKEARRAY(1, cols, LAMBDA(r,c,""))),
        safe
    )
)
```

**Example**:
```excel
=safeFilter(A1:C10, B1:B10>100)  // Safe filtering
// Returns empty array with correct column count if no matches
```

**Use Cases**:
- Reliable data filtering without formula errors
- JSON function internal operations
- Chain-able array operations

---

## makearr

**Purpose**: Convert range references into dynamic arrays using MAKEARRAY, ensuring consistent array behavior.

**Syntax**: 
```excel
=makearr(arr)
```

```excel
=LAMBDA(arr,MAKEARRAY(ROWS(arr),COLUMNS(arr),LAMBDA(a,b,INDEX(arr,a,b))))
```

**Example**:
```excel
=makearr(A1:C5)  // Converts range to dynamic array
```

**Use Cases**:
- Ensuring dynamic array behavior for range inputs
- Standardizing array operations
- Compatibility with array-based functions

---

## between

**Purpose**: Test whether a number falls within specified intervals using flexible notation including mathematical interval syntax and simple dash ranges.

**Syntax**: 
```excel
=between(number, rangeString)
```

**Interval Notation Supported**:
- `[a,b]` - Closed interval (includes both endpoints)
- `(a,b)` - Open interval (excludes both endpoints)  
- `[a,b)` - Half-open interval (includes a, excludes b)
- `(a,b]` - Half-open interval (excludes a, includes b)
- `a-b` - Simple dash notation (equivalent to [a,b])

**Example**:
```excel
=between(5, "[0,10]")     -> TRUE  (5 is in [0,10])
=between(0, "(0,10)")     -> FALSE (0 not in open interval)
=between(15, "10-20")     -> TRUE  (15 is in 10-20 range)
=between(25, "[0,10],[20,30]") -> TRUE (25 is in second interval)
```

**Multiple Intervals**:
```excel
=between(7, "[0,5],[10,15]")  -> FALSE (7 not in either interval)
=between(12, "[0,5],[10,15]") -> TRUE  (12 is in second interval)
```

**Use Cases**:
- Configuration-based range checking
- Dynamic threshold validation  
- Complex conditional logic
- Data validation rules

---

## inches

**Purpose**: Parse measurement strings and convert various units (yards, feet, inches) to total inches.

**Syntax**: 
```excel
=inches(inputValue)
```

**Supported Units**:
- `yards`, `yd` - Converts to inches (×36)
- `feet`, `ft`, `'` - Converts to inches (×12)  
- `inches`, `in`, `"` - Direct inches value
- Numbers without units - Treated as inches

**Example**:
```excel
=inches("2 yards")     -> 72    (2×36)
=inches("3 ft 6 in")   -> 42    (3×12 + 6)  
=inches("5'6\"")       -> 66    (5×12 + 6)
=inches("24")          -> 24    (direct inches)
```

**Complex Parsing**:
```excel
=inches("1 yard 2 feet 3 inches") -> 63  (36 + 24 + 3)
```

**Use Cases**:
- Construction and manufacturing measurements
- Converting mixed unit specifications  
- Standardizing measurement inputs
- CAD and design applications

---

## countOccurrencesText

**Purpose**: Count how many times a specific character or substring appears in a text string.

**Syntax**: 
```excel
=countOccurrencesText(cellRef, character)
```

```excel
=LAMBDA(cell_ref,char,IF(LEN(TRIM(cell_ref))=0,0,LEN(cell_ref)-LEN(SUBSTITUTE(cell_ref,char,""))+1))
```

**Example**:
```excel
=countOccurrencesText("hello world", "l")  -> 3
=countOccurrencesText("banana", "a")       -> 3  
=countOccurrencesText("", "x")             -> 0  (handles empty strings)
```

**Use Cases**:
- Text analysis and parsing
- Data quality validation
- String pattern detection
- CSV processing and delimiter counting

---

## isInSet

**Purpose**: Enhanced version of `between` that handles multiple range specifications and provides more flexible set membership testing.

**Syntax**: 
```excel
=isInSet(number, rangeArray)
```

**Features**:
- Supports same interval notation as `between`
- Handles arrays of range specifications
- More robust parsing for complex scenarios
- Returns FALSE for omitted ranges

**Example**:
```excel
=isInSet(15, {"[0,10]","[20,30]"})    -> FALSE
=isInSet(25, {"[0,10]","[20,30]"})    -> TRUE
=isInSet(5, )                         -> FALSE (omitted range)
```

**Advanced Usage**:
```excel
// Multiple overlapping ranges
=isInSet(12, {"(10,15)","[0,20]"})    -> TRUE (in both ranges)
```

**Use Cases**:
- Complex business rule validation
- Multi-criteria range checking  
- Advanced conditional formatting
- Dynamic filtering with multiple conditions

## Function Integration

These utility functions provide the foundation for safe, robust operations throughout the function library:

- **Safety Functions** (`safeDrop`, `safeFilter`, `makearr`) ensure reliable array operations
- **Validation Functions** (`between`, `isInSet`) enable sophisticated conditional logic
- **Text Processing** (`inches`, `countOccurrencesText`) handle specialized parsing needs

Together, they create a defensive programming approach that prevents errors and handles edge cases gracefully, making the entire function library more reliable and user-friendly.